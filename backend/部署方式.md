# Realtime Dialogue Backend 部署方式

基於 FastAPI 的即時語音對話後端服務，整合了 STT（語音轉文字）和 TTS（文字轉語音）功能。

## 技術棧

- **框架**: FastAPI
- **STT**: Faster-Whisper (Large-v3 模型)
- **TTS**: [BreezyVoice](https://github.com/mtkresearch/BreezyVoice) (聯發科開發台灣TTS)、[VibeVoice](https://github.com/microsoft/VibeVoice) (微軟開源TTS模型)、[Index-TTS](https://github.com/index-tts/index-tts) (bilibili開源)、[Spart-TTS](https://github.com/SparkAudio/Spark-TTS) (出門問問開源)
- **容器化**: Podman/Docker

## 功能特色

1. **語音轉文字 (STT)**: 使用 Faster-Whisper，支援中文語音辨識
2. **文字轉語音 (TTS)**: 支援各開源TTS，可自由切換，擴充性高
3. **聊天對話**: 內建聊天機器人邏輯
4. **完整對話流程**: 語音輸入 → 文字 → 聊天 → 語音輸出
5. **RESTful API**: 標準 HTTP API 介面

## 快速開始

### Clone 必要專案
- 需要 Git clone 使用到的開源專案
```bash
git clone https://github.com/mtkresearch/BreezyVoice.git
git clone https://github.com/microsoft/VibeVoice.git
git clone https://github.com/index-tts/index-tts.git
git clone https://github.com/SparkAudio/Spark-TTS.git
# 還有llm_tools
```

### 使用 Podman 啟動
```bash
# 建構容器
podman build --no-cache -t realtime-dialogue-backend .

# 啟動容器
cd /data/paul.fc.tsai_data/realtime-dialogue && podman run -d -p 8945:8000 --gpus all -v ./backend:/app:z -v ./models:/app/models:z -e LD_LIBRARY_PATH="/usr/local/lib/python3.10/dist-packages/nvidia/cudnn/lib:/usr/local/lib/python3.10/dist-packages/ctranslate2.libs:/usr/local/nvidia/lib:/usr/local/nvidia/lib64" -e FIPS_MODE=0 -e OPENSSL_FIPS=0 -e LIBCRYPTO_FIPS=0 --name realtime-dialogue-backend realtime-dialogue-backend

podman exec -it realtime-dialogue-backend bash -c "
# 創建 CUDNN 9.1 的符號鏈接到 CUDNN 8
cd /usr/local/lib/python3.10/dist-packages/nvidia/cudnn/lib/

# 檢查現有文件
ls -la libcudnn*

# 為 CUDNN 9.1 版本創建符號鏈接
ln -sf libcudnn_ops_infer.so.8 libcudnn_ops.so.9.1.0
ln -sf libcudnn_ops_infer.so.8 libcudnn_ops.so.9.1
ln -sf libcudnn_ops_infer.so.8 libcudnn_ops.so.9
ln -sf libcudnn_ops_infer.so.8 libcudnn_ops.so

echo 'Created symbolic links:'
ls -la libcudnn_ops*
"

podman exec -it realtime-dialogue-backend bash
```